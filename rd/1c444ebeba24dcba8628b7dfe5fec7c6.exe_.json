{"meta":{"timestamp":"2024-03-02T04:02:07.132524","version":"7.0.1","argv":["./tests/data/dotnet/1c444ebeba24dcba8628b7dfe5fec7c6.exe_","-j"],"sample":{"md5":"1c444ebeba24dcba8628b7dfe5fec7c6","sha1":"ebdec120fbbdbff28ebd6accc85d05f7ccabf461","sha256":"a9f9e5a30cc858dc135ec428cdd68cb06143732e5c62c4dc4b359c8abc11d74b","path":"C:/Users/HP/Documents/GitHub/capa/tests/data/dotnet/1c444ebeba24dcba8628b7dfe5fec7c6.exe_"},"flavor":"static","analysis":{"format":"pe","arch":"any","os":"any","extractor":"DnfileFeatureExtractor","rules":["C:/Users/HP/Documents/GitHub/capa/rules"],"base_address":{"type":"no address"},"layout":{"functions":[{"address":{"type":"dn token","value":100663316},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663316}}]},{"address":{"type":"dn token","value":100663336},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663336}}]},{"address":{"type":"dn token","value":100663339},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663339}}]},{"address":{"type":"dn token","value":100663343},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663343}}]},{"address":{"type":"dn token","value":100663348},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663348}}]},{"address":{"type":"dn token","value":100663353},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663353}}]},{"address":{"type":"dn token","value":100663358},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663358}}]},{"address":{"type":"dn token","value":100663364},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663364}}]},{"address":{"type":"dn token","value":100663368},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663368}}]},{"address":{"type":"dn token","value":100663373},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663373}}]},{"address":{"type":"dn token","value":100663374},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663374}}]},{"address":{"type":"dn token","value":100663378},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663378}}]},{"address":{"type":"dn token","value":100663379},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663379}}]},{"address":{"type":"dn token","value":100663383},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663383}}]},{"address":{"type":"dn token","value":100663388},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663388}}]},{"address":{"type":"dn token","value":100663393},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663393}}]},{"address":{"type":"dn token","value":100663394},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663394}}]},{"address":{"type":"dn token","value":100663395},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663395}}]},{"address":{"type":"dn token","value":100663398},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663398}}]},{"address":{"type":"dn token","value":100663425},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663425}}]},{"address":{"type":"dn token","value":100663428},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663428}}]},{"address":{"type":"dn token","value":100663429},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663429}}]},{"address":{"type":"dn token","value":100663431},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663431}}]},{"address":{"type":"dn token","value":100663434},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663434}}]},{"address":{"type":"dn token","value":100663436},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663436}}]},{"address":{"type":"dn token","value":100663439},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663439}}]},{"address":{"type":"dn token","value":100663441},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663441}}]},{"address":{"type":"dn token","value":100663444},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663444}}]},{"address":{"type":"dn token","value":100663445},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663445}}]},{"address":{"type":"dn token","value":100663446},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663446}}]},{"address":{"type":"dn token","value":100663450},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663450}}]},{"address":{"type":"dn token","value":100663456},"matched_basic_blocks":[{"address":{"type":"dn token","value":100663456}}]}]},"feature_counts":{"file":1245,"functions":[{"address":{"type":"dn token","value":100663297},"count":8},{"address":{"type":"dn token","value":100663298},"count":8},{"address":{"type":"dn token","value":100663299},"count":28},{"address":{"type":"dn token","value":100663300},"count":17},{"address":{"type":"dn token","value":100663301},"count":15},{"address":{"type":"dn token","value":100663302},"count":40},{"address":{"type":"dn token","value":100663303},"count":5},{"address":{"type":"dn token","value":100663304},"count":15},{"address":{"type":"dn token","value":100663305},"count":15},{"address":{"type":"dn token","value":100663306},"count":15},{"address":{"type":"dn token","value":100663307},"count":15},{"address":{"type":"dn token","value":100663308},"count":15},{"address":{"type":"dn token","value":100663309},"count":15},{"address":{"type":"dn token","value":100663310},"count":15},{"address":{"type":"dn token","value":100663311},"count":9},{"address":{"type":"dn token","value":100663312},"count":32},{"address":{"type":"dn token","value":100663313},"count":14},{"address":{"type":"dn token","value":100663314},"count":13},{"address":{"type":"dn token","value":100663315},"count":13},{"address":{"type":"dn token","value":100663316},"count":15},{"address":{"type":"dn token","value":100663317},"count":10},{"address":{"type":"dn token","value":100663318},"count":13},{"address":{"type":"dn token","value":100663319},"count":10},{"address":{"type":"dn token","value":100663320},"count":10},{"address":{"type":"dn token","value":100663321},"count":9},{"address":{"type":"dn token","value":100663322},"count":8},{"address":{"type":"dn token","value":100663323},"count":29},{"address":{"type":"dn token","value":100663324},"count":15},{"address":{"type":"dn token","value":100663325},"count":28},{"address":{"type":"dn token","value":100663326},"count":8},{"address":{"type":"dn token","value":100663327},"count":14},{"address":{"type":"dn token","value":100663328},"count":269},{"address":{"type":"dn token","value":100663329},"count":8},{"address":{"type":"dn token","value":100663330},"count":19},{"address":{"type":"dn token","value":100663331},"count":18},{"address":{"type":"dn token","value":100663332},"count":16},{"address":{"type":"dn token","value":100663333},"count":11},{"address":{"type":"dn token","value":100663334},"count":10},{"address":{"type":"dn token","value":100663335},"count":11},{"address":{"type":"dn token","value":100663336},"count":34},{"address":{"type":"dn token","value":100663337},"count":14},{"address":{"type":"dn token","value":100663338},"count":24},{"address":{"type":"dn token","value":100663339},"count":33},{"address":{"type":"dn token","value":100663340},"count":22},{"address":{"type":"dn token","value":100663341},"count":9},{"address":{"type":"dn token","value":100663342},"count":11},{"address":{"type":"dn token","value":100663343},"count":34},{"address":{"type":"dn token","value":100663344},"count":12},{"address":{"type":"dn token","value":100663345},"count":15},{"address":{"type":"dn token","value":100663346},"count":9},{"address":{"type":"dn token","value":100663347},"count":11},{"address":{"type":"dn token","value":100663348},"count":34},{"address":{"type":"dn token","value":100663349},"count":13},{"address":{"type":"dn token","value":100663350},"count":15},{"address":{"type":"dn token","value":100663351},"count":9},{"address":{"type":"dn token","value":100663352},"count":11},{"address":{"type":"dn token","value":100663353},"count":34},{"address":{"type":"dn token","value":100663354},"count":12},{"address":{"type":"dn token","value":100663355},"count":15},{"address":{"type":"dn token","value":100663356},"count":9},{"address":{"type":"dn token","value":100663357},"count":11},{"address":{"type":"dn token","value":100663358},"count":34},{"address":{"type":"dn token","value":100663359},"count":12},{"address":{"type":"dn token","value":100663360},"count":15},{"address":{"type":"dn token","value":100663361},"count":13},{"address":{"type":"dn token","value":100663362},"count":12},{"address":{"type":"dn token","value":100663363},"count":15},{"address":{"type":"dn token","value":100663364},"count":16},{"address":{"type":"dn token","value":100663365},"count":15},{"address":{"type":"dn token","value":100663366},"count":9},{"address":{"type":"dn token","value":100663367},"count":11},{"address":{"type":"dn token","value":100663368},"count":34},{"address":{"type":"dn token","value":100663369},"count":12},{"address":{"type":"dn token","value":100663370},"count":15},{"address":{"type":"dn token","value":100663371},"count":9},{"address":{"type":"dn token","value":100663372},"count":11},{"address":{"type":"dn token","value":100663373},"count":12},{"address":{"type":"dn token","value":100663374},"count":34},{"address":{"type":"dn token","value":100663375},"count":14},{"address":{"type":"dn token","value":100663376},"count":15},{"address":{"type":"dn token","value":100663377},"count":9},{"address":{"type":"dn token","value":100663378},"count":23},{"address":{"type":"dn token","value":100663379},"count":30},{"address":{"type":"dn token","value":100663380},"count":15},{"address":{"type":"dn token","value":100663381},"count":9},{"address":{"type":"dn token","value":100663382},"count":11},{"address":{"type":"dn token","value":100663383},"count":23},{"address":{"type":"dn token","value":100663384},"count":16},{"address":{"type":"dn token","value":100663385},"count":16},{"address":{"type":"dn token","value":100663386},"count":15},{"address":{"type":"dn token","value":100663387},"count":9},{"address":{"type":"dn token","value":100663388},"count":23},{"address":{"type":"dn token","value":100663389},"count":12},{"address":{"type":"dn token","value":100663390},"count":8},{"address":{"type":"dn token","value":100663391},"count":15},{"address":{"type":"dn token","value":100663392},"count":9},{"address":{"type":"dn token","value":100663393},"count":23},{"address":{"type":"dn token","value":100663394},"count":14},{"address":{"type":"dn token","value":100663395},"count":41},{"address":{"type":"dn token","value":100663396},"count":22},{"address":{"type":"dn token","value":100663397},"count":9},{"address":{"type":"dn token","value":100663398},"count":23},{"address":{"type":"dn token","value":100663399},"count":12},{"address":{"type":"dn token","value":100663400},"count":14},{"address":{"type":"dn token","value":100663401},"count":13},{"address":{"type":"dn token","value":100663402},"count":14},{"address":{"type":"dn token","value":100663403},"count":13},{"address":{"type":"dn token","value":100663404},"count":23},{"address":{"type":"dn token","value":100663405},"count":18},{"address":{"type":"dn token","value":100663406},"count":13},{"address":{"type":"dn token","value":100663407},"count":15},{"address":{"type":"dn token","value":100663408},"count":9},{"address":{"type":"dn token","value":100663409},"count":4},{"address":{"type":"dn token","value":100663410},"count":11},{"address":{"type":"dn token","value":100663411},"count":31},{"address":{"type":"dn token","value":100663412},"count":9},{"address":{"type":"dn token","value":100663419},"count":8},{"address":{"type":"dn token","value":100663424},"count":8},{"address":{"type":"dn token","value":100663425},"count":81},{"address":{"type":"dn token","value":100663426},"count":17},{"address":{"type":"dn token","value":100663427},"count":20},{"address":{"type":"dn token","value":100663428},"count":41},{"address":{"type":"dn token","value":100663429},"count":41},{"address":{"type":"dn token","value":100663430},"count":17},{"address":{"type":"dn token","value":100663431},"count":34},{"address":{"type":"dn token","value":100663432},"count":24},{"address":{"type":"dn token","value":100663433},"count":21},{"address":{"type":"dn token","value":100663434},"count":61},{"address":{"type":"dn token","value":100663435},"count":9},{"address":{"type":"dn token","value":100663436},"count":36},{"address":{"type":"dn token","value":100663437},"count":10},{"address":{"type":"dn token","value":100663438},"count":9},{"address":{"type":"dn token","value":100663439},"count":12},{"address":{"type":"dn token","value":100663440},"count":39},{"address":{"type":"dn token","value":100663441},"count":34},{"address":{"type":"dn token","value":100663442},"count":9},{"address":{"type":"dn token","value":100663443},"count":9},{"address":{"type":"dn token","value":100663444},"count":26},{"address":{"type":"dn token","value":100663445},"count":26},{"address":{"type":"dn token","value":100663446},"count":114},{"address":{"type":"dn token","value":100663447},"count":35},{"address":{"type":"dn token","value":100663448},"count":35},{"address":{"type":"dn token","value":100663449},"count":15},{"address":{"type":"dn token","value":100663450},"count":31},{"address":{"type":"dn token","value":100663451},"count":39},{"address":{"type":"dn token","value":100663452},"count":10},{"address":{"type":"dn token","value":100663453},"count":9},{"address":{"type":"dn token","value":100663454},"count":14},{"address":{"type":"dn token","value":100663455},"count":19},{"address":{"type":"dn token","value":100663456},"count":40}]},"library_functions":[]}},"rules":{"create process on Windows":{"meta":{"name":"create process on Windows","namespace":"host-interaction/process/create","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Process","Create Process"],"objective":"Process","behavior":"Create Process","method":"","id":"C0017"}],"references":[],"examples":["9324D1A8AE37A36AE560C37448C9705A:0x406DB0","Practical Malware Analysis Lab 01-04.exe_:0x4011FC","692f7fd6d198e804d6af98eb9e390d61:0x6000003"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create process on Windows\r\n    namespace: host-interaction/process/create\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Process::Create Process [C0017]\r\n    examples:\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x406DB0\r\n      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC\r\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\r\n  features:\r\n    - or:\r\n      - api: kernel32.WinExec\r\n      - api: kernel32.CreateProcess\r\n      - api: shell32.ShellExecute\r\n      - api: shell32.ShellExecuteEx\r\n      - api: advapi32.CreateProcessAsUser\r\n      - api: advapi32.CreateProcessWithLogon\r\n      - api: advapi32.CreateProcessWithToken\r\n      - api: kernel32.CreateProcessInternal\r\n      - api: ntdll.NtCreateUserProcess\r\n      - api: ntdll.NtCreateProcess\r\n      - api: ntdll.NtCreateProcessEx\r\n      - api: ntdll.ZwCreateProcess\r\n      - api: ZwCreateProcessEx\r\n      - api: ntdll.ZwCreateUserProcess\r\n      - api: ntdll.RtlCreateUserProcess\r\n      - api: System.Diagnostics.Process::Start\r\n","matches":[[{"type":"dn token","value":100663364},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinExec"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ShellExecute"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ShellExecuteEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessAsUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithLogon"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithToken"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessInternal"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateProcessEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateProcessEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Diagnostics.Process::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663364,6]}],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663425},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinExec"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ShellExecute"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ShellExecuteEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessAsUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithLogon"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithToken"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessInternal"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateProcessEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateProcessEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Diagnostics.Process::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,178]}],"captures":{}}],"locations":[],"captures":{}}]]},"create or open registry key":{"meta":{"name":"create or open registry key","authors":["michael.hunhoff@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Operating System","Registry","Create Registry Key"],"objective":"Operating System","behavior":"Registry","method":"Create Registry Key","id":"C0036.004"},{"parts":["Operating System","Registry","Open Registry Key"],"objective":"Operating System","behavior":"Registry","method":"Open Registry Key","id":"C0036.003"}],"references":[],"examples":["Practical Malware Analysis Lab 03-02.dll_:0x10004706","Practical Malware Analysis Lab 11-01.exe_:0x401000","493167E85E45363D09495D0841C30648:0x404D60","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E","692f7fd6d198e804d6af98eb9e390d61:0x6000003"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create or open registry key\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    lib: true\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Operating System::Registry::Create Registry Key [C0036.004]\r\n      - Operating System::Registry::Open Registry Key [C0036.003]\r\n    examples:\r\n      - Practical Malware Analysis Lab 03-02.dll_:0x10004706\r\n      - Practical Malware Analysis Lab 11-01.exe_:0x401000\r\n      - 493167E85E45363D09495D0841C30648:0x404D60\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E\r\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\r\n  features:\r\n    - or:\r\n      - api: advapi32.RegOpenKey\r\n      - api: advapi32.RegOpenKeyEx\r\n      - api: advapi32.RegCreateKey\r\n      - api: advapi32.RegCreateKeyEx\r\n      - api: advapi32.RegOpenCurrentUser\r\n      - api: advapi32.RegOpenKeyTransacted\r\n      - api: advapi32.RegOpenUserClassesRoot\r\n      - api: advapi32.RegCreateKeyTransacted\r\n      - api: ZwOpenKey\r\n      - api: ZwOpenKeyEx\r\n      - api: ZwCreateKey\r\n      - api: ZwOpenKeyTransacted\r\n      - api: ZwOpenKeyTransactedEx\r\n      - api: ZwCreateKeyTransacted\r\n      - api: NtOpenKey\r\n      - api: NtCreateKey\r\n      - api: SHRegOpenUSKey\r\n      - api: SHRegCreateUSKey\r\n      - api: RtlCreateRegistryKey\r\n      - api: Microsoft.Win32.RegistryKey::OpenSubKey\r\n      - api: Microsoft.Win32.RegistryKey::OpenBaseKey\r\n      - api: Microsoft.Win32.RegistryKey::OpenRemoteBaseKey\r\n      - api: Microsoft.Win32.RegistryKey::CreateSubKey\r\n","matches":[[{"type":"dn token","value":100663394},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenCurrentUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenUserClassesRoot"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransactedEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegOpenUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegCreateUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663394,11]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::CreateSubKey"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663395},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenCurrentUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenUserClassesRoot"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransactedEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegOpenUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegCreateUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663395,30]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::CreateSubKey"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"create thread":{"meta":{"name":"create thread","namespace":"host-interaction/thread/create","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com","joakim@intezer.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"basic block","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Process","Create Thread"],"objective":"Process","behavior":"Create Thread","method":"","id":"C0038"}],"references":[],"examples":["946A99F36A46D335DEC080D9A4371940:0x10001DA0","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x408020"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create thread\r\n    namespace: host-interaction/thread/create\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n      - joakim@intezer.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: thread\r\n    mbc:\r\n      - Process::Create Thread [C0038]\r\n    examples:\r\n      - 946A99F36A46D335DEC080D9A4371940:0x10001DA0\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x408020\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - or:\r\n          - api: kernel32.CreateThread\r\n          - api: _beginthread\r\n          - api: _beginthreadex\r\n          - api: PsCreateSystemThread\r\n          - api: SHCreateThread\r\n          - api: SHCreateThreadWithHandle\r\n          - api: kernel32.CreateRemoteThread\r\n          - api: kernel32.CreateRemoteThreadEx\r\n          - api: RtlCreateUserThread\r\n          - api: ntdll.NtCreateThread\r\n          - api: ntdll.NtCreateThreadEx\r\n          - api: ntdll.ZwCreateThread\r\n          - api: ntdll.ZwCreateThreadEx\r\n      - and:\r\n        - os: linux\r\n        - api: pthread_create\r\n      - and:\r\n        - api: System.Threading.Thread::Start\r\n        - optional:\r\n          - api: System.Threading.Thread::ctor\r\n","matches":[[{"type":"dn token","value":100663425},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"pthread_create"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,224]},{"type":"dn token offset","value":[100663425,269]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,202]},{"type":"dn token offset","value":[100663425,247]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthreadex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PsCreateSystemThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThreadWithHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThreadEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663431},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"pthread_create"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663431,74]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663431,58]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthreadex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PsCreateSystemThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThreadWithHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThreadEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663436},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"pthread_create"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663436,84]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663436,47]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthreadex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PsCreateSystemThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThreadWithHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThreadEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663444},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"pthread_create"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663444,65]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663444,48]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthreadex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PsCreateSystemThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThreadWithHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThreadEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663445},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"pthread_create"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663445,65]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663445,48]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthreadex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PsCreateSystemThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThreadWithHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThreadEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663450},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"pthread_create"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663450,80]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663450,48]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_beginthreadex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PsCreateSystemThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateThreadWithHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateRemoteThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateThreadEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateThreadEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"suspend thread":{"meta":{"name":"suspend thread","namespace":"host-interaction/thread/suspend","authors":["0x534a@mailbox.org","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Process","Suspend Thread"],"objective":"Process","behavior":"Suspend Thread","method":"","id":"C0055"}],"references":[],"examples":["787cbc8a6d1bc58ea169e51e1ad029a637f22560660cc129ab8a099a745bd50e:0x502f4c"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: suspend thread\r\n    namespace: host-interaction/thread/suspend\r\n    authors:\r\n      - 0x534a@mailbox.org\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Process::Suspend Thread [C0055]\r\n    examples:\r\n      - 787cbc8a6d1bc58ea169e51e1ad029a637f22560660cc129ab8a099a745bd50e:0x502f4c\r\n  features:\r\n    - or:\r\n      - api: kernel32.SuspendThread\r\n      - api: ntdll.NtSuspendThread\r\n      - api: ntdll.ZwSuspendThread\r\n      - api: System.Threading.Thread::Suspend\r\n      - api: System.Threading.Thread::Sleep\r\n","matches":[[{"type":"dn token","value":100663428},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Suspend"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Sleep"}},"children":[],"locations":[{"type":"dn token offset","value":[100663428,133]},{"type":"dn token offset","value":[100663428,120]}],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663429},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Suspend"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Sleep"}},"children":[],"locations":[{"type":"dn token offset","value":[100663429,120]},{"type":"dn token offset","value":[100663429,133]}],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663434},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Suspend"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Sleep"}},"children":[],"locations":[{"type":"dn token offset","value":[100663434,294]},{"type":"dn token offset","value":[100663434,285]},{"type":"dn token offset","value":[100663434,5]},{"type":"dn token offset","value":[100663434,187]}],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663439},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Suspend"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Sleep"}},"children":[],"locations":[{"type":"dn token offset","value":[100663439,1]}],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663441},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwSuspendThread"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Suspend"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Thread::Sleep"}},"children":[],"locations":[{"type":"dn token offset","value":[100663441,105]}],"captures":{}}],"locations":[],"captures":{}}]]},"encode data using Base64":{"meta":{"name":"encode data using Base64","namespace":"data-manipulation/encoding/base64","authors":["moritz.raabe@mandiant.com","anushka.virgaonkar@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function"},"attack":[{"parts":["Defense Evasion","Obfuscated Files or Information"],"tactic":"Defense Evasion","technique":"Obfuscated Files or Information","subtechnique":"","id":"T1027"}],"mbc":[{"parts":["Defense Evasion","Obfuscated Files or Information","Encoding-Standard Algorithm"],"objective":"Defense Evasion","behavior":"Obfuscated Files or Information","method":"Encoding-Standard Algorithm","id":"E1027.m02"},{"parts":["Data","Encode Data","Base64"],"objective":"Data","behavior":"Encode Data","method":"Base64","id":"C0026.001"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x1314889C","074072B261FC27B65C72671F13510C05:0x100049B2","5DB2D2BE20D59AA0BE6709A6850F1775:0x18001CC30","08AC667C65D36D6542917655571E61C8:0x406EAA"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: encode data using Base64\r\n    namespace: data-manipulation/encoding/base64\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported\r\n    att&ck:\r\n      - Defense Evasion::Obfuscated Files or Information [T1027]\r\n    mbc:\r\n      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]\r\n      - Data::Encode Data::Base64 [C0026.001]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x1314889C\r\n      - 074072B261FC27B65C72671F13510C05:0x100049B2\r\n      - 5DB2D2BE20D59AA0BE6709A6850F1775:0x18001CC30\r\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\r\n  features:\r\n    - or:\r\n      - and:\r\n        - mnemonic: shl\r\n        - mnemonic: shr\r\n        - number: 0x3F = modulo 64\r\n        - or:\r\n          - number: 0x3D = '='\r\n          - number: 0x3D3D = '=='\r\n        - match: contain loop\r\n        - optional:\r\n          - number: 2\r\n          - number: 3\r\n          - number: 4\r\n          - number: 6\r\n          - number: 0xF\r\n          - string: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\r\n      - api: System.Convert::ToBase64String\r\n      - api: System.Convert::ToBase64CharArray\r\n      - api: System.Convert::TryToBase64Chars\r\n","matches":[[{"type":"dn token","value":100663323},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663323,48]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663336},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663336,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663336,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663336,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663336,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663336,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663340},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663340,23]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663343},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663343,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663343,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663343,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663343,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663343,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663348},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663348,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663348,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663348,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663348,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663348,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663353},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663353,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663353,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663353,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663353,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663353,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663358},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663358,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663358,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663358,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663358,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663358,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663368},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663368,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663368,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663368,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663368,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663368,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663374},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663374,64]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663374,30]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663374,39]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663374,47]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[{"type":"dn token offset","value":[100663374,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663396},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663396,23]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663456},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663456,62]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::ToBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryToBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shr"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":63,"description":"modulo 64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":61,"description":"'='"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15677,"description":"'=='"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2}},"children":[],"locations":[{"type":"dn token offset","value":[100663456,29]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":3}},"children":[],"locations":[{"type":"dn token offset","value":[100663456,42]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":4}},"children":[],"locations":[{"type":"dn token offset","value":[100663456,50]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":6}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":15}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"hash data with MD5":{"meta":{"name":"hash data with MD5","namespace":"data-manipulation/hashing/md5","authors":["moritz.raabe@mandiant.com","anushka.virgaonkar@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Cryptography","Cryptographic Hash","MD5"],"objective":"Cryptography","behavior":"Cryptographic Hash","method":"MD5","id":"C0029.001"}],"references":["https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp"],"examples":["Practical Malware Analysis Lab 05-01.dll_:0x100108ED"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: hash data with MD5\r\n    namespace: data-manipulation/hashing/md5\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Cryptography::Cryptographic Hash::MD5 [C0029.001]\r\n    references:\r\n      - https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp\r\n    examples:\r\n      - Practical Malware Analysis Lab 05-01.dll_:0x100108ED\r\n  features:\r\n    - or:\r\n      - and:\r\n        - description: magic initialization constants from MD4 and MD5\r\n        - number: 0x67452301 = A, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\r\n        - number: 0xefcdab89 = B, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\r\n        - number: 0x98badcfe = C, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\r\n        - number: 0x10325476 = D, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\r\n        - not:\r\n          - number: 0xc3d2e1f0 = likely SHA1 but also used in RIPEMD-160 and RIPEMD-320\r\n        - optional:\r\n          - description: specific compilation from https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp\r\n          - and:\r\n            - offset: -0x28955B88\r\n            - offset: -0x173848AA\r\n      - basic block:\r\n        - and:\r\n          - number: 0x8003 = CALG_MD5\r\n          - api: advapi32.CryptCreateHash\r\n      - call:\r\n        - and:\r\n          - number: 0x8003 = CALG_MD5\r\n          - api: advapi32.CryptCreateHash\r\n      - and:\r\n        - format: dotnet\r\n        - or:\r\n          - api: System.Security.Cryptography.MD5::Create\r\n          - api: System.Security.Cryptography.MD5CryptoServiceProvider::ctor\r\n        - optional:\r\n          - api: System.Security.Cryptography.HashAlgorithm::ComputeHash\r\n","matches":[[{"type":"dn token","value":100663325},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"hash data with MD5/e95cc69a3c214f429bf6b65124ab15ce"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"hash data with MD5/df8e90902d8c4a0096a53bcf79b56221"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"format","format":"dotnet"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Security.Cryptography.MD5::Create"}},"children":[],"locations":[{"type":"dn token offset","value":[100663325,0]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Security.Cryptography.MD5CryptoServiceProvider::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Security.Cryptography.HashAlgorithm::ComputeHash"}},"children":[],"locations":[{"type":"dn token offset","value":[100663325,20]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and","description":"magic initialization constants from MD4 and MD5"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":1732584193,"description":"A, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4023233417,"description":"B, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2562383102,"description":"C, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":271733878,"description":"D, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"not"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":3285377520,"description":"likely SHA1 but also used in RIPEMD-160 and RIPEMD-320"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional","description":"specific compilation from https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":-680876936}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":-389564586}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"decode data using Base64 in .NET":{"meta":{"name":"decode data using Base64 in .NET","namespace":"data-manipulation/encoding/base64","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[{"parts":["Defense Evasion","Deobfuscate/Decode Files or Information"],"tactic":"Defense Evasion","technique":"Deobfuscate/Decode Files or Information","subtechnique":"","id":"T1140"}],"mbc":[{"parts":["Data","Decode Data","Base64"],"objective":"Data","behavior":"Decode Data","method":"Base64","id":"C0053.001"}],"references":[],"examples":[],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: decode data using Base64 in .NET\r\n    namespace: data-manipulation/encoding/base64\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    att&ck:\r\n      - Defense Evasion::Deobfuscate/Decode Files or Information [T1140]\r\n    mbc:\r\n      - Data::Decode Data::Base64 [C0053.001]\r\n  features:\r\n    - or:\r\n      - api: System.Convert::FromBase64String\r\n      - api: System.Convert::FromBase64CharArray\r\n      - api: System.Convert::TryFromBase64Chars\r\n      - api: System.Convert::TryFromBase64String\r\n","matches":[[{"type":"dn token","value":100663331},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::FromBase64String"}},"children":[],"locations":[{"type":"dn token offset","value":[100663331,12]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::FromBase64CharArray"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryFromBase64Chars"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Convert::TryFromBase64String"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"enumerate files in .NET":{"meta":{"name":"enumerate files in .NET","namespace":"host-interaction/file-system/files/list","authors":["moritz.raabe@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[{"parts":["Discovery","File and Directory Discovery"],"tactic":"Discovery","technique":"File and Directory Discovery","subtechnique":"","id":"T1083"}],"mbc":[{"parts":["Discovery","File and Directory Discovery"],"objective":"Discovery","behavior":"File and Directory Discovery","method":"","id":"E1083"}],"references":["https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b"],"examples":[],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: enumerate files in .NET\r\n    namespace: host-interaction/file-system/files/list\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    att&ck:\r\n      - Discovery::File and Directory Discovery [T1083]\r\n    mbc:\r\n      - Discovery::File and Directory Discovery [E1083]\r\n    references:\r\n      - https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b\r\n  features:\r\n    - or:\r\n      - api: System.IO.DirectoryInfo::GetFiles\r\n      - api: System.IO.DirectoryInfo::EnumerateFiles\r\n      - api: System.IO.Directory::GetFiles\r\n      - api: System.IO.Directory::EnumerateFiles\r\n      - api: System.IO.Directory::EnumerateFileSystemEntries\r\n      - api: System.IO.DirectoryInfo::GetDirectories\r\n      - api: System.IO.DirectoryInfo::EnumerateDirectories\r\n      - api: System.IO.Directory::GetDirectories\r\n      - api: System.IO.Directory::EnumerateDirectories\r\n","matches":[[{"type":"dn token","value":100663338},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::GetFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::EnumerateFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::GetFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::EnumerateFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::EnumerateFileSystemEntries"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::GetDirectories"}},"children":[],"locations":[{"type":"dn token offset","value":[100663338,6]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::EnumerateDirectories"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::GetDirectories"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::EnumerateDirectories"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663339},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::GetFiles"}},"children":[],"locations":[{"type":"dn token offset","value":[100663339,6]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::EnumerateFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::GetFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::EnumerateFiles"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::EnumerateFileSystemEntries"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::GetDirectories"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::EnumerateDirectories"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::GetDirectories"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::EnumerateDirectories"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"get file size":{"meta":{"name":"get file size","namespace":"host-interaction/file-system/meta","authors":["michael.hunhoff@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[{"parts":["Discovery","File and Directory Discovery"],"tactic":"Discovery","technique":"File and Directory Discovery","subtechnique":"","id":"T1083"}],"mbc":[{"parts":["Discovery","File and Directory Discovery"],"objective":"Discovery","behavior":"File and Directory Discovery","method":"","id":"E1083"}],"references":[],"examples":["mimikatz.exe_:0x40630D"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: get file size\r\n    namespace: host-interaction/file-system/meta\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    att&ck:\r\n      - Discovery::File and Directory Discovery [T1083]\r\n    mbc:\r\n      - Discovery::File and Directory Discovery [E1083]\r\n    examples:\r\n      - mimikatz.exe_:0x40630D\r\n  features:\r\n    - or:\r\n      - api: kernel32.GetFileSize\r\n      - api: kernel32.GetFileSizeEx\r\n      - property/read: System.IO.FileInfo::Length\r\n","matches":[[{"type":"dn token","value":100663339},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetFileSize"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetFileSizeEx"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.IO.FileInfo::Length"}},"children":[],"locations":[{"type":"dn token offset","value":[100663339,64]}],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetFileSize"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetFileSizeEx"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.IO.FileInfo::Length"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,599]}],"captures":{}}],"locations":[],"captures":{}}]]},"delete file":{"meta":{"name":"delete file","namespace":"host-interaction/file-system/delete","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["File System","Delete File"],"objective":"File System","behavior":"Delete File","method":"","id":"C0047"}],"references":[],"examples":["946A99F36A46D335DEC080D9A4371940:0x100015F0","31600AD0D1A7EA615690DF111AE36C73:0x401A15","563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140001E04"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: delete file\r\n    namespace: host-interaction/file-system/delete\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - File System::Delete File [C0047]\r\n    examples:\r\n      - 946A99F36A46D335DEC080D9A4371940:0x100015F0\r\n      # MoveFileEx\r\n      - 31600AD0D1A7EA615690DF111AE36C73:0x401A15\r\n      # NtDeleteFile\r\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140001E04\r\n  features:\r\n    - or:\r\n      - api: kernel32.DeleteFile\r\n      - api: DeleteFileTransacted\r\n      - api: NtDeleteFile\r\n      - api: ZwDeleteFile\r\n      - api: remove\r\n      - api: _wremove\r\n      - api: System.IO.File::Delete\r\n      - api: System.IO.FileSystemInfo::Delete\r\n      # static\r\n      - basic block:\r\n        - and:\r\n          - number: 3 = FO_DELETE\r\n          - or:\r\n            - api: kernel32.SHFileOperation\r\n      - basic block:\r\n        - and:\r\n          - number: 4 = MOVEFILE_DELAY_UNTIL_REBOOT\r\n          - number: 0 = NULL\r\n          - api: MoveFileEx\r\n      # dynamic\r\n      - call:\r\n        - and:\r\n          - number: 3 = FO_DELETE\r\n          - or:\r\n            - api: kernel32.SHFileOperation\r\n      - call:\r\n        - and:\r\n          - number: 4 = MOVEFILE_DELAY_UNTIL_REBOOT\r\n          - number: 0 = NULL\r\n          - api: MoveFileEx\r\n","matches":[[{"type":"dn token","value":100663344},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"DeleteFile"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"DeleteFileTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtDeleteFile"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwDeleteFile"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"remove"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_wremove"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.File::Delete"}},"children":[],"locations":[{"type":"dn token offset","value":[100663344,6]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.FileSystemInfo::Delete"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"delete file/00aad03637c84e94bf55d202a2ee182b"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"delete file/151e22d3008641a6a149f42cd6607e2a"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"delete file/854ded870b144717becaec50462f13fe"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"delete file/a4b2ab1fb6e2462ea549774c9d42e3be"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"delete directory":{"meta":{"name":"delete directory","namespace":"host-interaction/file-system/delete","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[],"mbc":[{"parts":["File System","Delete Directory"],"objective":"File System","behavior":"Delete Directory","method":"","id":"C0048"}],"references":[],"examples":["Practical Malware Analysis Lab 05-01.dll_:0x10009236","AFB6EC3D721A5CB67863487B0E51A34C167F629CF701F8BC7A038C117B4DDA44:0x429AA0"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: delete directory\r\n    namespace: host-interaction/file-system/delete\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    mbc:\r\n      - File System::Delete Directory [C0048]\r\n    examples:\r\n      - Practical Malware Analysis Lab 05-01.dll_:0x10009236\r\n      - AFB6EC3D721A5CB67863487B0E51A34C167F629CF701F8BC7A038C117B4DDA44:0x429AA0\r\n  features:\r\n    - or:\r\n      - api: RemoveDirectory\r\n      - api: RemoveDirectoryTransacted\r\n      - api: rmdir\r\n      - api: _rmdir\r\n      - api: _wrmdir\r\n      - api: System.IO.DirectoryInfo::Delete\r\n      - api: System.IO.Directory::Delete\r\n","matches":[[{"type":"dn token","value":100663349},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RemoveDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RemoveDirectoryTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"rmdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_rmdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_wrmdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::Delete"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::Delete"}},"children":[],"locations":[{"type":"dn token offset","value":[100663349,7]}],"captures":{}}],"locations":[],"captures":{}}]]},"create directory":{"meta":{"name":"create directory","namespace":"host-interaction/file-system/create","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[],"mbc":[{"parts":["File System","Create Directory"],"objective":"File System","behavior":"Create Directory","method":"","id":"C0046"}],"references":[],"examples":["Practical Malware Analysis Lab 17-02.dll_:0x10008f62","692f7fd6d198e804d6af98eb9e390d61:0x6000003"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create directory\r\n    namespace: host-interaction/file-system/create\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    mbc:\r\n      - File System::Create Directory [C0046]\r\n    examples:\r\n      - Practical Malware Analysis Lab 17-02.dll_:0x10008f62\r\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\r\n  features:\r\n    - or:\r\n      - api: kernel32.CreateDirectory\r\n      - api: kernel32.CreateDirectoryEx\r\n      - api: kernel32.CreateDirectoryTransacted\r\n      - api: NtCreateDirectoryObject\r\n      - api: ZwCreateDirectoryObject\r\n      - api: SHCreateDirectory\r\n      - api: SHCreateDirectoryEx\r\n      - api: mkdir\r\n      - api: _mkdir\r\n      - api: _wmkdir\r\n      - api: System.IO.Directory::CreateDirectory\r\n      - api: System.IO.DirectoryInfo::Create\r\n      - api: System.IO.DirectoryInfo::CreateSubdirectory\r\n","matches":[[{"type":"dn token","value":100663354},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDirectoryEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDirectoryTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateDirectoryObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateDirectoryObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateDirectoryEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"mkdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_mkdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_wmkdir"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::CreateDirectory"}},"children":[],"locations":[{"type":"dn token offset","value":[100663354,6]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::Create"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::CreateSubdirectory"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663403},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDirectoryEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDirectoryTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateDirectoryObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateDirectoryObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHCreateDirectoryEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"mkdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_mkdir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"_wmkdir"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::CreateDirectory"}},"children":[],"locations":[{"type":"dn token offset","value":[100663403,19]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::Create"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.DirectoryInfo::CreateSubdirectory"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"query or enumerate registry key":{"meta":{"name":"query or enumerate registry key","namespace":"host-interaction/registry","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[{"parts":["Discovery","Query Registry"],"tactic":"Discovery","technique":"Query Registry","subtechnique":"","id":"T1012"}],"mbc":[{"parts":["Operating System","Registry","Query Registry Key"],"objective":"Operating System","behavior":"Registry","method":"Query Registry Key","id":"C0036.005"}],"references":[],"examples":["493167E85E45363D09495D0841C30648:0x404930","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402608"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: query or enumerate registry key\r\n    namespace: host-interaction/registry\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    att&ck:\r\n      - Discovery::Query Registry [T1012]\r\n    mbc:\r\n      - Operating System::Registry::Query Registry Key [C0036.005]\r\n    examples:\r\n      - 493167E85E45363D09495D0841C30648:0x404930\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402608\r\n  features:\r\n    - and:\r\n      - optional:\r\n        - match: create or open registry key\r\n      - or:\r\n        - api: advapi32.RegEnumKey\r\n        - api: advapi32.RegEnumKeyEx\r\n        - api: advapi32.RegQueryInfoKeyA\r\n        - api: ZwQueryKey\r\n        - api: ZwEnumerateKey\r\n        - api: NtQueryKey\r\n        - api: NtEnumerateKey\r\n        - api: RtlCheckRegistryKey\r\n        - api: SHEnumKeyEx\r\n        - api: SHQueryInfoKey\r\n        - api: SHRegEnumUSKey\r\n        - api: SHRegQueryInfoUSKey\r\n        - api: Microsoft.Win32.RegistryKey::GetSubKeyNames\r\n        - api: Microsoft.Win32.RegistryKey::OpenBaseKey\r\n        - api: Microsoft.Win32.RegistryKey::OpenRemoteBaseKey\r\n        - api: Microsoft.Win32.RegistryKey::OpenSubKey\r\n","matches":[[{"type":"dn token","value":100663394},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"create or open registry key"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenCurrentUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenUserClassesRoot"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransactedEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegOpenUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegCreateUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663394,11]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::CreateSubKey"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663394}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegEnumKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegEnumKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegQueryInfoKeyA"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwQueryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwEnumerateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtQueryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtEnumerateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCheckRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHEnumKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHQueryInfoKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegEnumUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegQueryInfoUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::GetSubKeyNames"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663394,11]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663395},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"create or open registry key"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenCurrentUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenUserClassesRoot"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransactedEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegOpenUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegCreateUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663395,30]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::CreateSubKey"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663395}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegEnumKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegEnumKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegQueryInfoKeyA"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwQueryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwEnumerateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtQueryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtEnumerateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCheckRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHEnumKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHQueryInfoKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegEnumUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegQueryInfoUSKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::GetSubKeyNames"}},"children":[],"locations":[{"type":"dn token offset","value":[100663395,6]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663395,30]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"query or enumerate registry value":{"meta":{"name":"query or enumerate registry value","namespace":"host-interaction/registry","authors":["william.ballenthin@mandiant.com","michael.hunhoff@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[{"parts":["Discovery","Query Registry"],"tactic":"Discovery","technique":"Query Registry","subtechnique":"","id":"T1012"}],"mbc":[{"parts":["Operating System","Registry","Query Registry Value"],"objective":"Operating System","behavior":"Registry","method":"Query Registry Value","id":"C0036.006"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A","Practical Malware Analysis Lab 03-02.dll_:0x100047AD"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: query or enumerate registry value\r\n    namespace: host-interaction/registry\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    att&ck:\r\n      - Discovery::Query Registry [T1012]\r\n    mbc:\r\n      - Operating System::Registry::Query Registry Value [C0036.006]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A\r\n      - Practical Malware Analysis Lab 03-02.dll_:0x100047AD\r\n  features:\r\n    - and:\r\n      - optional:\r\n        - match: create or open registry key\r\n      - or:\r\n        - api: advapi32.RegGetValue\r\n        - api: advapi32.RegEnumValue\r\n        - api: advapi32.RegQueryValue\r\n        - api: advapi32.RegQueryValueEx\r\n        - api: advapi32.RegQueryMultipleValues\r\n        - api: ZwQueryValueKey\r\n        - api: ZwEnumerateValueKey\r\n        - api: NtQueryValueKey\r\n        - api: NtEnumerateValueKey\r\n        - api: RtlQueryRegistryValues\r\n        - api: SHGetValue\r\n        - api: SHEnumValue\r\n        - api: SHRegGetInt\r\n        - api: SHRegGetPath\r\n        - api: SHRegGetValue\r\n        - api: SHQueryValueEx\r\n        - api: SHRegGetUSValue\r\n        - api: SHOpenRegStream\r\n        - api: SHRegEnumUSValue\r\n        - api: SHOpenRegStream2\r\n        - api: SHRegQueryUSValue\r\n        - api: SHRegGetBoolUSValue\r\n        - api: SHRegGetValueFromHKCUHKLM\r\n        - api: SHRegGetBoolValueFromHKCUHKLM\r\n        - api: Microsoft.Win32.RegistryKey::GetValue\r\n        - api: Microsoft.Win32.RegistryKey::GetValueKind\r\n        - api: Microsoft.Win32.RegistryKey::GetValueNames\r\n        - api: Microsoft.Win32.Registry::GetValue\r\n","matches":[[{"type":"dn token","value":100663395},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"create or open registry key"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenCurrentUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenUserClassesRoot"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransactedEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegOpenUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegCreateUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[{"type":"dn token offset","value":[100663395,30]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::CreateSubKey"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663395}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegGetValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegEnumValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegQueryValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegQueryValueEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegQueryMultipleValues"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwQueryValueKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwEnumerateValueKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtQueryValueKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtEnumerateValueKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlQueryRegistryValues"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHEnumValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetInt"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetPath"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHQueryValueEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetUSValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHOpenRegStream"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegEnumUSValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHOpenRegStream2"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegQueryUSValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetBoolUSValue"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetValueFromHKCUHKLM"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegGetBoolValueFromHKCUHKLM"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::GetValue"}},"children":[],"locations":[{"type":"dn token offset","value":[100663395,117]},{"type":"dn token offset","value":[100663395,141]},{"type":"dn token offset","value":[100663395,69]},{"type":"dn token offset","value":[100663395,93]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::GetValueKind"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::GetValueNames"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.Registry::GetValue"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"get common file path":{"meta":{"name":"get common file path","namespace":"host-interaction/file-system","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[{"parts":["Discovery","File and Directory Discovery"],"tactic":"Discovery","technique":"File and Directory Discovery","subtechnique":"","id":"T1083"}],"mbc":[{"parts":["Discovery","File and Directory Discovery"],"objective":"Discovery","behavior":"File and Directory Discovery","method":"","id":"E1083"}],"references":[],"examples":["Practical Malware Analysis Lab 03-02.dll_:0x10003415","972B219F18379907A045431303F4DA7D:0x404887"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: get common file path\r\n    namespace: host-interaction/file-system\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    att&ck:\r\n      - Discovery::File and Directory Discovery [T1083]\r\n    mbc:\r\n      - Discovery::File and Directory Discovery [E1083]\r\n    examples:\r\n      - Practical Malware Analysis Lab 03-02.dll_:0x10003415\r\n      - 972B219F18379907A045431303F4DA7D:0x404887\r\n  features:\r\n    - or:\r\n      - api: kernel32.GetTempPath\r\n      - api: kernel32.GetTempFileName\r\n      - api: kernel32.GetSystemDirectory\r\n      - api: kernel32.GetWindowsDirectory\r\n      - api: kernel32.GetSystemWow64Directory\r\n      - api: GetAllUsersProfileDirectory\r\n      - api: GetAppContainerFolderPath\r\n      - api: GetCurrentDirectory\r\n      - api: GetDefaultUserProfileDirectory\r\n      - api: GetProfilesDirectory\r\n      - api: GetUserProfileDirectory\r\n      - api: SHGetFolderPathAndSubDir\r\n      - api: shell32.SHGetFolderPath\r\n      - api: shell32.SHGetFolderLocation\r\n      - api: shell32.SHGetKnownFolderPath\r\n      - api: shell32.SHGetSpecialFolderPath\r\n      - api: shell32.SHGetSpecialFolderLocation\r\n      - api: System.IO.Directory::GetCurrentDirectory\r\n      - api: System.Environment::GetFolderPath\r\n      - property/read: System.Environment::SystemDirectory\r\n      - property/read: System.Environment::CurrentDirectory\r\n","matches":[[{"type":"dn token","value":100663401},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetTempPath"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetTempFileName"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetSystemDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetWindowsDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetSystemWow64Directory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetAllUsersProfileDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetAppContainerFolderPath"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetCurrentDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetDefaultUserProfileDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetProfilesDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetUserProfileDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetFolderPathAndSubDir"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetFolderPath"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetFolderLocation"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetKnownFolderPath"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetSpecialFolderPath"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHGetSpecialFolderLocation"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::GetCurrentDirectory"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Environment::GetFolderPath"}},"children":[],"locations":[{"type":"dn token offset","value":[100663401,3]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Environment::SystemDirectory"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Environment::CurrentDirectory"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"check if directory exists":{"meta":{"name":"check if directory exists","namespace":"host-interaction/file-system/exists","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[{"parts":["Discovery","File and Directory Discovery"],"tactic":"Discovery","technique":"File and Directory Discovery","subtechnique":"","id":"T1083"}],"mbc":[],"references":[],"examples":[],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: check if directory exists\r\n    namespace: host-interaction/file-system/exists\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    att&ck:\r\n      - Discovery::File and Directory Discovery [T1083]\r\n  features:\r\n    - or:\r\n      - api: System.IO.Directory::Exists\r\n","matches":[[{"type":"dn token","value":100663403},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Directory::Exists"}},"children":[],"locations":[{"type":"dn token offset","value":[100663403,6]}],"captures":{}}],"locations":[],"captures":{}}]]},"save image in .NET":{"meta":{"name":"save image in .NET","namespace":"collection","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function"},"attack":[],"mbc":[],"references":[],"examples":[],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: save image in .NET\r\n    namespace: collection\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires class features\r\n  features:\r\n    - and:\r\n      - api: System.Drawing.Image::Save\r\n      - optional:\r\n        - class: System.Drawing.Imaging.ImageFormat\r\n","matches":[[{"type":"dn token","value":100663405},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Drawing.Image::Save"}},"children":[],"locations":[{"type":"dn token offset","value":[100663405,17]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"class","class_":"System.Drawing.Imaging.ImageFormat"}},"children":[],"locations":[{"type":"dn token offset","value":[100663405,12]}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"unmanaged call":{"meta":{"name":"unmanaged call","namespace":"runtime","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function"},"attack":[],"mbc":[],"references":[],"examples":[],"description":"managed code calls unmanaged (native) code, often seen in .NET","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: unmanaged call\r\n    namespace: runtime\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    description: managed code calls unmanaged (native) code, often seen in .NET\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported\r\n  features:\r\n    - or:\r\n      - characteristic: unmanaged call\r\n      - match: unmanaged call via dynamic PInvoke in .NET\r\n      - api: System.Runtime.InteropServices.Marshal::GetDelegateForFunctionPointer\r\n","matches":[[{"type":"dn token","value":100663410},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"unmanaged call"}},"children":[],"locations":[{"type":"dn token offset","value":[100663410,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"unmanaged call via dynamic PInvoke in .NET"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Runtime.InteropServices.Marshal::GetDelegateForFunctionPointer"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663411},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"unmanaged call"}},"children":[],"locations":[{"type":"dn token offset","value":[100663411,117]},{"type":"dn token offset","value":[100663411,1]},{"type":"dn token offset","value":[100663411,78]},{"type":"dn token offset","value":[100663411,142]},{"type":"dn token offset","value":[100663411,125]},{"type":"dn token offset","value":[100663411,109]},{"type":"dn token offset","value":[100663411,99]},{"type":"dn token offset","value":[100663411,67]},{"type":"dn token offset","value":[100663411,57]},{"type":"dn token offset","value":[100663411,18]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"unmanaged call via dynamic PInvoke in .NET"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Runtime.InteropServices.Marshal::GetDelegateForFunctionPointer"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"capture screenshot":{"meta":{"name":"capture screenshot","namespace":"collection/screenshot","authors":["moritz.raabe@mandiant.com","@_re_fox","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[{"parts":["Collection","Screen Capture"],"tactic":"Collection","technique":"Screen Capture","subtechnique":"","id":"T1113"}],"mbc":[{"parts":["Collection","Screen Capture","WinAPI"],"objective":"Collection","behavior":"Screen Capture","method":"WinAPI","id":"E1113.m01"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x1314610A","7204e3efc2434012e13ca939db0d0b02:0x414070","50D5EE1CE2CA5E30C6B1019EE64EEEC2:0x406E07"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: capture screenshot\r\n    namespace: collection/screenshot\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - \"@_re_fox\"\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    att&ck:\r\n      - Collection::Screen Capture [T1113]\r\n    mbc:\r\n      - Collection::Screen Capture::WinAPI [E1113.m01]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x1314610A\r\n      - 7204e3efc2434012e13ca939db0d0b02:0x414070\r\n      - 50D5EE1CE2CA5E30C6B1019EE64EEEC2:0x406E07\r\n  features:\r\n    - or:\r\n      - and:\r\n        - or:\r\n          - api: user32.GetWindowDC\r\n          - api: user32.GetDC\r\n          - and:\r\n            - api: gdi32.CreateDC\r\n            - string: \"DISPLAY\"\r\n        - or:\r\n          - api: gdi32.BitBlt\r\n          - api: gdi32.GetDIBits\r\n        - api: gdi32.CreateCompatibleDC\r\n        - api: gdi32.CreateCompatibleBitmap\r\n        - optional:\r\n          - or:\r\n            - api: user32.GetSystemMetrics = fetch screen dimensions\r\n            - api: user32.GetDesktopWindow = get entire desktop\r\n      - basic block:\r\n        - and:\r\n          - api: BitBlt\r\n          - characteristic: tight loop\r\n      - call:\r\n        - and:\r\n          - api: BitBlt\r\n      - api: System.Drawing.Graphics::CopyFromScreen\r\n","matches":[[{"type":"dn token","value":100663411},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"capture screenshot/9ee783c47288450ebeb97bf84d4c54a7"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"capture screenshot/4ce7328dc8d44c7790c81fc3ca46c643"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Drawing.Graphics::CopyFromScreen"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"GetWindowDC"}},"children":[],"locations":[{"type":"dn token offset","value":[100663411,1]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetDC"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateDC"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"string","string":"DISPLAY"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"BitBlt"}},"children":[],"locations":[{"type":"dn token offset","value":[100663411,99]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetDIBits"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"CreateCompatibleDC"}},"children":[],"locations":[{"type":"dn token offset","value":[100663411,57]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"CreateCompatibleBitmap"}},"children":[],"locations":[{"type":"dn token offset","value":[100663411,67]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetSystemMetrics","description":"fetch screen dimensions"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetDesktopWindow","description":"get entire desktop"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"create a process with modified I/O handles and window":{"meta":{"name":"create a process with modified I/O handles and window","namespace":"host-interaction/process/create","authors":["matthew.williams@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function"},"attack":[],"mbc":[{"parts":["Process","Create Process"],"objective":"Process","behavior":"Create Process","method":"","id":"C0017"}],"references":["https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa"],"examples":["Practical Malware Analysis Lab 14-02.exe_:0x4011C0"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create a process with modified I/O handles and window\r\n    namespace: host-interaction/process/create\r\n    authors:\r\n      - matthew.williams@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires property features\r\n    mbc:\r\n      - Process::Create Process [C0017]\r\n    references:\r\n      - https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa\r\n    examples:\r\n      - Practical Malware Analysis Lab 14-02.exe_:0x4011C0\r\n  features:\r\n    - or:\r\n      - and:\r\n        - or:\r\n          - description: API functions that accept a pointer to a STARTUPINFO structure\r\n          - api: kernel32.CreateProcess\r\n          - api: kernel32.CreateProcessInternal\r\n          - api: advapi32.CreateProcessAsUser\r\n          - api: advapi32.CreateProcessWithLogon\r\n          - api: advapi32.CreateProcessWithToken\r\n        - number: 0x101 = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW\r\n          # STARTF_USESTDHANDLES indicates the hStdInput, hStdOutput, and hStdError members contain additional information\r\n          # STARTF_USESHOWWINDOW indicates the wShowWindow member contains additional information\r\n        - or:\r\n          - and:\r\n            - arch: i386\r\n            - number: 0x44 = StartupInfo.cb (size)\r\n          - and:\r\n            - arch: amd64\r\n            - number: 0x68 = StartupInfo.cb (size)\r\n          # STARTUPINFOEX size values not currently supported by this rule.\r\n        - optional:\r\n          - api: kernel32.GetStartupInfo\r\n      - and:\r\n        - api: System.Diagnostics.Process::Start\r\n        - or:\r\n          - property/write: System.Diagnostics.ProcessStartInfo::UseShellExecute\r\n          - property/write: System.Diagnostics.ProcessStartInfo::Verb\r\n          - property/write: System.Diagnostics.ProcessStartInfo::WindowStyle\r\n          - property/write: System.Diagnostics.ProcessStartInfo::WorkingDirectory\r\n          - property/write: System.Diagnostics.ProcessStartInfo::FileName\r\n          - property/write: System.Diagnostics.ProcessStartInfo::Arguments\r\n          - property/write: System.Diagnostics.ProcessStartInfo::CreateNoWindow\r\n          - property/write: System.Diagnostics.ProcessStartInfo::RedirectStandardOutput\r\n          - property/write: System.Diagnostics.ProcessStartInfo::RedirectStandardInput\r\n          - property/read: System.Diagnostics.Process::StandardOutput\r\n          - property/read: System.Diagnostics.Process::StandardInput\r\n","matches":[[{"type":"dn token","value":100663425},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Diagnostics.Process::Start"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,178]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::UseShellExecute"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,122]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::Verb"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::WindowStyle"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::WorkingDirectory"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,150]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::FileName"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,74]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::Arguments"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::CreateNoWindow"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,134]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::RedirectStandardOutput"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,98]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Diagnostics.ProcessStartInfo::RedirectStandardInput"}},"children":[],"locations":[{"type":"dn token offset","value":[100663425,86]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Diagnostics.Process::StandardOutput"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Diagnostics.Process::StandardInput"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"API functions that accept a pointer to a STARTUPINFO structure"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessInternal"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessAsUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithLogon"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithToken"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":257,"description":"STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":68,"description":"StartupInfo.cb (size)"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":104,"description":"StartupInfo.cb (size)"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetStartupInfo"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"act as TCP client":{"meta":{"name":"act as TCP client","namespace":"communication/tcp/client","authors":["william.ballenthin@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","TCP Client"],"objective":"Communication","behavior":"Socket Communication","method":"TCP Client","id":"C0001.008"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: act as TCP client\r\n    namespace: communication/tcp/client\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Communication::Socket Communication::TCP Client [C0001.008]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - or:\r\n      - match: connect TCP socket\r\n      - api: System.Net.Sockets.TcpClient::ctor\r\n","matches":[[{"type":"dn token","value":100663434},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.TcpClient::ctor"}},"children":[],"locations":[{"type":"dn token offset","value":[100663434,38]}],"captures":{}}],"locations":[],"captures":{}}]]},"send request in .NET":{"meta":{"name":"send request in .NET","namespace":"communication/http/client","authors":["anushka.virgaonakr@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[{"parts":["Command and Control","Application Layer Protocol","Web Protocols"],"tactic":"Command and Control","technique":"Application Layer Protocol","subtechnique":"Web Protocols","id":"T1071.001"}],"mbc":[{"parts":["Communication","HTTP Communication","Send Request"],"objective":"Communication","behavior":"HTTP Communication","method":"Send Request","id":"C0002.003"}],"references":[],"examples":[],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: send request in .NET\r\n    namespace: communication/http/client\r\n    authors:\r\n      - anushka.virgaonakr@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    att&ck:\r\n      - Command and Control::Application Layer Protocol::Web Protocols [T1071.001]\r\n    mbc:\r\n      - Communication::HTTP Communication::Send Request [C0002.003]\r\n  features:\r\n    - and:\r\n      - or:\r\n        - api: System.Net.WebRequest::GetRequestStream\r\n        - api: System.Net.WebRequest::GetRequestStreamAsync\r\n        - and:\r\n          - api: System.Net.WebRequest::BeginGetRequestStream\r\n          - api: System.Net.WebRequest::EndGetRequestStream\r\n      - api: System.IO.Stream::Write\r\n      - api: System.IO.Stream::Close\r\n","matches":[[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Stream::Write"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,833]},{"type":"dn token offset","value":[100663446,788]},{"type":"dn token offset","value":[100663446,688]},{"type":"dn token offset","value":[100663446,1122]},{"type":"dn token offset","value":[100663446,1212]},{"type":"dn token offset","value":[100663446,977]},{"type":"dn token offset","value":[100663446,1108]},{"type":"dn token offset","value":[100663446,802]},{"type":"dn token offset","value":[100663446,847]},{"type":"dn token offset","value":[100663446,1181]},{"type":"dn token offset","value":[100663446,991]},{"type":"dn token offset","value":[100663446,1049]}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.Stream::Close"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,1226]},{"type":"dn token offset","value":[100663446,1279]},{"type":"dn token offset","value":[100663446,1077]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetRequestStream"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,672]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetRequestStreamAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::BeginGetRequestStream"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::EndGetRequestStream"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"send HTTP request":{"meta":{"name":"send HTTP request","namespace":"communication/http/client","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Communication","HTTP Communication","Send Request"],"objective":"Communication","behavior":"HTTP Communication","method":"Send Request","id":"C0002.003"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60","6A352C3E55E8AE5ED39DC1BE7FB964B1:0x100026E0"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: send HTTP request\r\n    namespace: communication/http/client\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Communication::HTTP Communication::Send Request [C0002.003]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\r\n      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x100026E0\r\n  features:\r\n    - or:\r\n      - api: System.Net.WebRequest::GetResponse\r\n      - api: System.Net.WebRequest::GetResponseAsync\r\n      - and:\r\n        - or:\r\n          - api: wininet.HttpOpenRequest\r\n          - api: wininet.InternetConnect\r\n        - or:\r\n          - api: wininet.HttpSendRequest\r\n          - api: wininet.HttpSendRequestEx\r\n      - and:\r\n        - api: winhttp.WinHttpSendRequest\r\n        - api: winhttp.WinHttpWriteData\r\n        - optional:\r\n          - or:\r\n            - api: winhttp.WinHttpOpenRequest\r\n            - api: winhttp.WinHttpConnect\r\n      - and:\r\n        - match: send data on socket\r\n        - string: /HTTP/i\r\n","matches":[[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,1232]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponseAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HTTP/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequestEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpWriteData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663451},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,124]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponseAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HTTP/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequestEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpWriteData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"create HTTP request":{"meta":{"name":"create HTTP request","namespace":"communication/http/client","authors":["michael.hunhoff@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Communication","HTTP Communication","Create Request"],"objective":"Communication","behavior":"HTTP Communication","method":"Create Request","id":"C0002.012"}],"references":[],"examples":["6f99a2c8944cb02ff28c6f9ced59b161:0x40E2F0"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create HTTP request\r\n    namespace: communication/http/client\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Communication::HTTP Communication::Create Request [C0002.012]\r\n    examples:\r\n      - 6f99a2c8944cb02ff28c6f9ced59b161:0x40E2F0\r\n  features:\r\n    - and:\r\n      - or:\r\n        - api: wininet.InternetOpen\r\n        - api: System.Net.WebRequest::Create\r\n        - api: System.Net.WebRequest::CreateDefault\r\n        - api: System.Net.WebRequest::CreateHttp\r\n      - optional:\r\n        - api: wininet.InternetCloseHandle\r\n","matches":[[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetCloseHandle"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetOpen"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::Create"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,7]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::CreateDefault"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::CreateHttp"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663451},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetCloseHandle"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetOpen"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::Create"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,110]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::CreateDefault"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::CreateHttp"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"send data":{"meta":{"name":"send data","namespace":"communication","authors":["william.ballenthin@mandiant.com","joakim@intezer.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Command and Control","C2 Communication","Send Data"],"objective":"Command and Control","behavior":"C2 Communication","method":"Send Data","id":"B0030.001"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60"],"description":"all known techniques for sending data to a potential C2 server","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: send data\r\n    namespace: communication\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - joakim@intezer.com\r\n    description: all known techniques for sending data to a potential C2 server\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Command and Control::C2 Communication::Send Data [B0030.001]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - or:\r\n          - match: send HTTP request\r\n          - match: send data on socket\r\n          - match: send file via HTTP\r\n          - match: send data to Internet\r\n      - and:\r\n        - os: linux\r\n        - or: # Require network bound socket.\r\n          - match: create TCP socket\r\n          - match: create UDP socket\r\n        - or:\r\n          - match: send HTTP request\r\n          - match: send data on socket\r\n          - match: send file via HTTP\r\n","matches":[[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"send HTTP request"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,1232]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponseAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HTTP/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequestEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpWriteData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663446}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send file via HTTP"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data to Internet"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"create TCP socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"create UDP socket"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"send HTTP request"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,1232]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponseAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HTTP/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequestEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpWriteData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663446}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send file via HTTP"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663451},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"send HTTP request"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,124]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponseAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HTTP/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequestEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpWriteData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663451}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send file via HTTP"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data to Internet"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"create TCP socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"create UDP socket"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"send HTTP request"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,124]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponseAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HTTP/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"InternetConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"HttpSendRequestEx"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpSendRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpWriteData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpOpenRequest"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpConnect"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"dn token","value":100663451}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send file via HTTP"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"receive HTTP response":{"meta":{"name":"receive HTTP response","namespace":"communication/http/client","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Communication","HTTP Communication","Get Response"],"objective":"Communication","behavior":"HTTP Communication","method":"Get Response","id":"C0002.017"}],"references":[],"examples":["6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10002790"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: receive HTTP response\r\n    namespace: communication/http/client\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Communication::HTTP Communication::Get Response [C0002.017]\r\n    examples:\r\n      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10002790\r\n  features:\r\n    - or:\r\n      - api: System.Net.WebRequest::GetResponse\r\n      - api: winhttp.WinHttpReceiveResponse\r\n      - and:\r\n        - api: winhttp.WinHttpReadData\r\n        - optional:\r\n          - api: winhttp.WinHttpQueryDataAvailable\r\n","matches":[[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,1232]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpReceiveResponse"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpReadData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpQueryDataAvailable"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"dn token","value":100663451},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebRequest::GetResponse"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,124]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpReceiveResponse"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpReadData"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinHttpQueryDataAvailable"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"set web proxy in .NET":{"meta":{"name":"set web proxy in .NET","namespace":"communication/http","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function"},"attack":[],"mbc":[],"references":[],"examples":[],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: set web proxy in .NET\r\n    namespace: communication/http\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires property features\r\n  features:\r\n    - and:\r\n      - property/write: System.Net.WebRequest::Proxy\r\n      - optional:\r\n        - api: System.Net.WebProxy::ctor\r\n","matches":[[{"type":"dn token","value":100663446},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"property","access":"write","property":"System.Net.WebRequest::Proxy"}},"children":[],"locations":[{"type":"dn token offset","value":[100663446,32]}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.WebProxy::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"check if file exists":{"meta":{"name":"check if file exists","namespace":"host-interaction/file-system/exists","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[{"parts":["Discovery","File and Directory Discovery"],"tactic":"Discovery","technique":"File and Directory Discovery","subtechnique":"","id":"T1083"}],"mbc":[{"parts":["Discovery","File and Directory Discovery"],"objective":"Discovery","behavior":"File and Directory Discovery","method":"","id":"E1083"}],"references":[],"examples":["31600AD0D1A7EA615690DF111AE36C73:0x401284"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: check if file exists\r\n    namespace: host-interaction/file-system/exists\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    att&ck:\r\n      - Discovery::File and Directory Discovery [T1083]\r\n    mbc:\r\n      - Discovery::File and Directory Discovery [E1083]\r\n    examples:\r\n      - 31600AD0D1A7EA615690DF111AE36C73:0x401284\r\n  features:\r\n    - or:\r\n      - basic block:\r\n        - and:\r\n          - api: kernel32.GetFileAttributes\r\n          - instruction:\r\n            - mnemonic: cmp\r\n            - number: 0xFFFFFFFF = INVALID_FILE_ATTRIBUTES\r\n      - basic block:\r\n        - and:\r\n          - api: kernel32.GetLastError\r\n          - instruction:\r\n            - mnemonic: cmp\r\n            - number: 2 = ERROR_FILE_NOT_FOUND\r\n      - api: shlwapi.PathFileExists\r\n      - api: System.IO.File::Exists\r\n      - property/read: System.IO.FileSystemInfo::Exists\r\n","matches":[[{"type":"dn token","value":100663451},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"check if file exists/71a9ac3378a549dd8a00a31dc1eeb180"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"check if file exists/a039fdffa08040fabf99312614f547a5"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"PathFileExists"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.IO.File::Exists"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,82]}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.IO.FileSystemInfo::Exists"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"manipulate console buffer":{"meta":{"name":"manipulate console buffer","namespace":"host-interaction/console","authors":["william.ballenthin@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Operating System","Console"],"objective":"Operating System","behavior":"Console","method":"","id":"C0033"}],"references":["https://stackoverflow.com/a/15770935/87207"],"examples":["3aa7ee4d67f562933bc998f352b1f319:0x705413A0"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: manipulate console buffer\r\n    namespace: host-interaction/console\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Operating System::Console [C0033]\r\n    references:\r\n      - https://stackoverflow.com/a/15770935/87207\r\n    examples:\r\n      - 3aa7ee4d67f562933bc998f352b1f319:0x705413A0\r\n  features:\r\n    - or:\r\n      - and:\r\n        - or:\r\n          - api: kernel32.SetConsoleCursorPosition\r\n          - api: kernel32.ReadConsoleOutputCharacter\r\n          - api: kernel32.WriteConsoleOutputCharacter\r\n          - api: kernel32.WriteConsoleOutput\r\n          - api: kernel32.WriteConsoleInput\r\n        - optional:\r\n          - api: kernel32.GetStdHandle\r\n          - number: 0xfffffff5 = STD_OUTPUT_HANDLE\r\n      - api: System.Console::Write\r\n      - api: System.Console::WriteLine\r\n","matches":[[{"type":"dn token","value":100663451},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Console::Write"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"System.Console::WriteLine"}},"children":[],"locations":[{"type":"dn token offset","value":[100663451,44]}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SetConsoleCursorPosition"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ReadConsoleOutputCharacter"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WriteConsoleOutputCharacter"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WriteConsoleOutput"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WriteConsoleInput"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetStdHandle"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4294967285,"description":"STD_OUTPUT_HANDLE"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"compiled to the .NET platform":{"meta":{"name":"compiled to the .NET platform","namespace":"runtime/dotnet","authors":["william.ballenthin@mandiant.com"],"scopes":{"static":"file","dynamic":"file"},"attack":[],"mbc":[],"references":[],"examples":["b9f5bd514485fb06da39beff051b9fdc"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: compiled to the .NET platform\r\n    namespace: runtime/dotnet\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n    scopes:\r\n      static: file\r\n      dynamic: file\r\n    examples:\r\n      - b9f5bd514485fb06da39beff051b9fdc\r\n  features:\r\n    - or:\r\n      - format: dotnet\r\n      - import: mscoree._CorExeMain\r\n      - import: mscoree._corexemain\r\n      - import: mscoree._CorDllMain\r\n      - import: mscoree._cordllmain\r\n","matches":[[{"type":"no address"},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"format","format":"dotnet"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"import","import_":"mscoree._CorExeMain"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"import","import_":"mscoree._corexemain"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"import","import_":"mscoree._CorDllMain"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"import","import_":"mscoree._cordllmain"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]}}}
