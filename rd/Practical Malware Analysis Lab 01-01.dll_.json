{"meta":{"timestamp":"2024-03-02T04:12:18.077282","version":"7.0.1","argv":["./tests/data/Practical Malware Analysis Lab 01-01.dll_","-j"],"sample":{"md5":"290934c61de9176ad682ffdd65f0a669","sha1":"a4b35de71ca20fe776dc72d12fb2886736f43c22","sha256":"f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba","path":"C:/Users/HP/Documents/GitHub/capa/tests/data/Practical Malware Analysis Lab 01-01.dll_"},"flavor":"static","analysis":{"format":"pe","arch":"i386","os":"windows","extractor":"VivisectFeatureExtractor","rules":["C:/Users/HP/Documents/GitHub/capa/rules"],"base_address":{"type":"absolute","value":268435456},"layout":{"functions":[{"address":{"type":"absolute","value":268439568},"matched_basic_blocks":[{"address":{"type":"absolute","value":268439598}},{"address":{"type":"absolute","value":268439692}},{"address":{"type":"absolute","value":268439715}},{"address":{"type":"absolute","value":268439868}},{"address":{"type":"absolute","value":268439892}},{"address":{"type":"absolute","value":268439905}},{"address":{"type":"absolute","value":268439929}},{"address":{"type":"absolute","value":268440000}},{"address":{"type":"absolute","value":268440040}}]}]},"feature_counts":{"file":128,"functions":[{"address":{"type":"absolute","value":268439568},"count":142},{"address":{"type":"absolute","value":268440472},"count":7}]},"library_functions":[{"address":{"type":"absolute","value":268440096},"name":"__alloca_probe"},{"address":{"type":"absolute","value":268440143},"name":"__CRT_INIT@12"},{"address":{"type":"absolute","value":268440314},"name":"__DllMainCRTStartup@12"}]}},"rules":{"check mutex":{"meta":{"name":"check mutex","namespace":"host-interaction/mutex","authors":["moritz.raabe@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"basic block","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Process","Check Mutex"],"objective":"Process","behavior":"Check Mutex","method":"","id":"C0043"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: check mutex\r\n    namespace: host-interaction/mutex\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: thread\r\n    mbc:\r\n      - Process::Check Mutex [C0043]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - and:\r\n      - or:\r\n        - api: kernel32.OpenMutex\r\n        - match: create mutex\r\n        - api: System.Threading.Mutex::OpenExisting\r\n        - api: System.Threading.Mutex::TryOpenExisting\r\n      - optional:\r\n        - or:\r\n          - api: kernel32.GetLastError\r\n          - number: 2 = ERROR_FILE_NOT_FOUND\r\n          - number: 0xB7 = ERROR_ALREADY_EXISTS\r\n","matches":[[{"type":"absolute","value":268439598},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"OpenMutex"}},"children":[],"locations":[{"type":"absolute","value":268439641}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"create mutex"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Mutex::OpenExisting"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Mutex::TryOpenExisting"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"GetLastError"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2,"description":"ERROR_FILE_NOT_FOUND"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":183,"description":"ERROR_ALREADY_EXISTS"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"create TCP socket":{"meta":{"name":"create TCP socket","namespace":"communication/socket/tcp","authors":["william.ballenthin@mandiant.com","joakim@intezer.com","anushka.virgaonkar@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","Create TCP Socket"],"objective":"Communication","behavior":"Socket Communication","method":"Create TCP Socket","id":"C0001.011"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create TCP socket\r\n    namespace: communication/socket/tcp\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - joakim@intezer.com\r\n      - anushka.virgaonkar@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Communication::Socket Communication::Create TCP Socket [C0001.011]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - or:\r\n      - and:\r\n        - number: 6 = IPPROTO_TCP\r\n        - number: 1 = SOCK_STREAM\r\n        - number: 2 = AF_INET\r\n        - or:\r\n          - api: ws2_32.socket\r\n          - api: ws2_32.WSASocket\r\n          - api: socket\r\n          - api: System.Net.Sockets.Socket::ctor\r\n      - property/read: System.Net.Sockets.TcpClient::Client\r\n","matches":[[{"type":"absolute","value":268439692},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Net.Sockets.TcpClient::Client"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6,"description":"IPPROTO_TCP"}},"children":[],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":1,"description":"SOCK_STREAM"}},"children":[],"locations":[{"type":"absolute","value":268439694}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2,"description":"AF_INET"}},"children":[],"locations":[{"type":"absolute","value":268439696}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASocket"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"delay execution":{"meta":{"name":"delay execution","authors":["michael.hunhoff@mandiant.com","@ramen0x3f"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Anti-Behavioral Analysis","Dynamic Analysis Evasion","Delayed Execution"],"objective":"Anti-Behavioral Analysis","behavior":"Dynamic Analysis Evasion","method":"Delayed Execution","id":"B0003.003"}],"references":["https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions","https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp"],"examples":["al-khaser_x86.exe_:0x449770","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: delay execution\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - \"@ramen0x3f\"\r\n    lib: true\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]\r\n    references:\r\n      - https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions\r\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp\r\n    examples:\r\n      - al-khaser_x86.exe_:0x449770\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - or:\r\n          - api: kernel32.Sleep\r\n          - api: kernel32.SleepEx\r\n          - api: kernel32.WaitForSingleObject\r\n          - api: kernel32.SignalObjectAndWait\r\n          - api: kernel32.WaitForSingleObjectEx\r\n          - api: kernel32.WaitForMultipleObjects\r\n          - api: kernel32.WaitForMultipleObjectsEx\r\n          - api: kernel32.RegisterWaitForSingleObject\r\n          - api: WaitOnAddress\r\n          - api: user32.MsgWaitForMultipleObjects\r\n          - api: user32.MsgWaitForMultipleObjectsEx\r\n          - api: NtDelayExecution\r\n          - api: KeWaitForSingleObject\r\n          - api: KeDelayExecutionThread\r\n      - and:\r\n        - os: linux\r\n        - or:\r\n          - api: sleep\r\n          - api: usleep\r\n","matches":[[{"type":"absolute","value":268439892},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"sleep"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"usleep"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Sleep"}},"children":[],"locations":[{"type":"absolute","value":268439897}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SleepEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SignalObjectAndWait"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForSingleObjectEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForMultipleObjects"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForMultipleObjectsEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegisterWaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitOnAddress"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"MsgWaitForMultipleObjects"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"MsgWaitForMultipleObjectsEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtDelayExecution"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"KeWaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"KeDelayExecutionThread"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":268440000},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"sleep"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"usleep"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"Sleep"}},"children":[],"locations":[{"type":"absolute","value":268440005}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SleepEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SignalObjectAndWait"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForSingleObjectEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForMultipleObjects"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForMultipleObjectsEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegisterWaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitOnAddress"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"MsgWaitForMultipleObjects"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"MsgWaitForMultipleObjectsEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtDelayExecution"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"KeWaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"KeDelayExecutionThread"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"create process on Windows":{"meta":{"name":"create process on Windows","namespace":"host-interaction/process/create","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Process","Create Process"],"objective":"Process","behavior":"Create Process","method":"","id":"C0017"}],"references":[],"examples":["9324D1A8AE37A36AE560C37448C9705A:0x406DB0","Practical Malware Analysis Lab 01-04.exe_:0x4011FC","692f7fd6d198e804d6af98eb9e390d61:0x6000003"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create process on Windows\r\n    namespace: host-interaction/process/create\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Process::Create Process [C0017]\r\n    examples:\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x406DB0\r\n      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC\r\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\r\n  features:\r\n    - or:\r\n      - api: kernel32.WinExec\r\n      - api: kernel32.CreateProcess\r\n      - api: shell32.ShellExecute\r\n      - api: shell32.ShellExecuteEx\r\n      - api: advapi32.CreateProcessAsUser\r\n      - api: advapi32.CreateProcessWithLogon\r\n      - api: advapi32.CreateProcessWithToken\r\n      - api: kernel32.CreateProcessInternal\r\n      - api: ntdll.NtCreateUserProcess\r\n      - api: ntdll.NtCreateProcess\r\n      - api: ntdll.NtCreateProcessEx\r\n      - api: ntdll.ZwCreateProcess\r\n      - api: ZwCreateProcessEx\r\n      - api: ntdll.ZwCreateUserProcess\r\n      - api: ntdll.RtlCreateUserProcess\r\n      - api: System.Diagnostics.Process::Start\r\n","matches":[[{"type":"absolute","value":268439929},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WinExec"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcess"}},"children":[],"locations":[{"type":"absolute","value":268439983}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ShellExecute"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ShellExecuteEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessAsUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithLogon"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessWithToken"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateProcessInternal"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateProcessEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateProcessEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateUserProcess"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Diagnostics.Process::Start"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"send data on socket":{"meta":{"name":"send data on socket","namespace":"communication/socket/send","authors":["moritz.raabe@mandiant.com","joakim@intezer.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","Send Data"],"objective":"Communication","behavior":"Socket Communication","method":"Send Data","id":"C0001.007"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: send data on socket\r\n    namespace: communication/socket/send\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - joakim@intezer.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    mbc:\r\n      - Communication::Socket Communication::Send Data [C0001.007]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - or:\r\n      - api: ws2_32.send\r\n      - api: ws2_32.sendto\r\n      - api: ws2_32.WSASend\r\n      - api: ws2_32.WSASendMsg\r\n      - api: ws2_32.WSASendTo\r\n      - api: send\r\n      - api: System.Net.Sockets.Socket::Send\r\n      - api: System.Net.Sockets.Socket::SendAsync\r\n      - api: System.Net.Sockets.Socket::SendTo\r\n      - api: System.Net.Sockets.Socket::SendToAsync\r\n      - api: System.Net.Sockets.UdpClient::Send\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"send"}},"children":[],"locations":[{"type":"absolute","value":268439809}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"sendto"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASend"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASendMsg"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASendTo"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"send"}},"children":[],"locations":[{"type":"absolute","value":268439809}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::Send"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendTo"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendToAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.UdpClient::Send"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"initialize Winsock library":{"meta":{"name":"initialize Winsock library","namespace":"communication/socket","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","Initialize Winsock Library"],"objective":"Communication","behavior":"Socket Communication","method":"Initialize Winsock Library","id":"C0001.009"}],"references":[],"examples":["6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10001D30"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: initialize Winsock library\r\n    namespace: communication/socket\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    mbc:\r\n      - Communication::Socket Communication::Initialize Winsock Library [C0001.009]\r\n    examples:\r\n      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10001D30\r\n  features:\r\n    - and:\r\n      - api: ws2_32.WSAStartup\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"WSAStartup"}},"children":[],"locations":[{"type":"absolute","value":268439678}],"captures":{}}],"locations":[],"captures":{}}]]},"create mutex":{"meta":{"name":"create mutex","namespace":"host-interaction/mutex","authors":["moritz.raabe@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[],"mbc":[{"parts":["Process","Create Mutex"],"objective":"Process","behavior":"Create Mutex","method":"","id":"C0042"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create mutex\r\n    namespace: host-interaction/mutex\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    mbc:\r\n      - Process::Create Mutex [C0042]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - or:\r\n      - api: kernel32.CreateMutex\r\n      - api: kernel32.CreateMutexEx\r\n      - api: System.Threading.Mutex::ctor\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"CreateMutex"}},"children":[],"locations":[{"type":"absolute","value":268439662}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"CreateMutexEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Threading.Mutex::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"contain loop":{"meta":{"name":"contain loop","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"function"},"attack":[],"mbc":[],"references":[],"examples":["08AC667C65D36D6542917655571E61C8:0x406EAA"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: contain loop\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    lib: true\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires characteristic features\r\n    examples:\r\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\r\n  features:\r\n    - or:\r\n      - characteristic: loop\r\n      - characteristic: tight loop\r\n      - characteristic: recursive call\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":268439568}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"receive data on socket":{"meta":{"name":"receive data on socket","namespace":"communication/socket/receive","authors":["moritz.raabe@mandiant.com","joakim@intezer.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"call"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","Receive Data"],"objective":"Communication","behavior":"Socket Communication","method":"Receive Data","id":"C0001.006"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: receive data on socket\r\n    namespace: communication/socket/receive\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - joakim@intezer.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: call\r\n    mbc:\r\n      - Communication::Socket Communication::Receive Data [C0001.006]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - or:\r\n      - api: ws2_32.recv\r\n      - api: ws2_32.recvfrom\r\n      - api: ws2_32.WSARecv\r\n      - api: ws2_32.WSARecvDisconnect\r\n      - api: ws2_32.WSARecvEx\r\n      - api: ws2_32.WSARecvFrom\r\n      - api: ws2_32.WSARecvMsg\r\n      - api: recv\r\n      - api: System.Net.Sockets.Socket::Receive\r\n      - api: System.Net.Sockets.Socket::ReceiveAsync\r\n      - api: System.Net.Sockets.Socket::ReceiveFrom\r\n      - api: System.Net.Sockets.Socket::ReceiveFromAsync\r\n      - api: System.Net.Sockets.Socket::ReceiveMessageFrom\r\n      - api: System.Net.Sockets.Socket::ReceiveMessageFromAsync\r\n      - api: System.Net.Sockets.Socket::BeginReceive\r\n      - api: System.Net.Sockets.Socket::BeginReceiveFrom\r\n      - api: System.Net.Sockets.Socket::BeginReceiveMessageFrom\r\n      - api: System.Net.Sockets.Socket::EndReceive\r\n      - api: System.Net.Sockets.Socket::EndReceiveFrom\r\n      - api: System.Net.Sockets.Socket::EndReceiveMessageFrom\r\n      - api: recvmsg\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"recv"}},"children":[],"locations":[{"type":"absolute","value":268439858}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"recvfrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecv"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvDisconnect"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvMsg"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"recv"}},"children":[],"locations":[{"type":"absolute","value":268439858}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::Receive"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveFromAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveMessageFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveMessageFromAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::BeginReceive"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::BeginReceiveFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::BeginReceiveMessageFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::EndReceive"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::EndReceiveFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::EndReceiveMessageFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"recvmsg"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"send data":{"meta":{"name":"send data","namespace":"communication","authors":["william.ballenthin@mandiant.com","joakim@intezer.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Command and Control","C2 Communication","Send Data"],"objective":"Command and Control","behavior":"C2 Communication","method":"Send Data","id":"B0030.001"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60"],"description":"all known techniques for sending data to a potential C2 server","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: send data\r\n    namespace: communication\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - joakim@intezer.com\r\n    description: all known techniques for sending data to a potential C2 server\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Command and Control::C2 Communication::Send Data [B0030.001]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - or:\r\n          - match: send HTTP request\r\n          - match: send data on socket\r\n          - match: send file via HTTP\r\n          - match: send data to Internet\r\n      - and:\r\n        - os: linux\r\n        - or: # Require network bound socket.\r\n          - match: create TCP socket\r\n          - match: create UDP socket\r\n        - or:\r\n          - match: send HTTP request\r\n          - match: send data on socket\r\n          - match: send file via HTTP\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send HTTP request"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"send"}},"children":[],"locations":[{"type":"absolute","value":268439809}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"sendto"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASend"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASendMsg"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASendTo"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"send"}},"children":[],"locations":[{"type":"absolute","value":268439809}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::Send"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendTo"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendToAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.UdpClient::Send"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439568}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send file via HTTP"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send data to Internet"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"create TCP socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Net.Sockets.TcpClient::Client"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6,"description":"IPPROTO_TCP"}},"children":[],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":1,"description":"SOCK_STREAM"}},"children":[],"locations":[{"type":"absolute","value":268439694}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2,"description":"AF_INET"}},"children":[],"locations":[{"type":"absolute","value":268439696}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASocket"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"create UDP socket"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send HTTP request"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"send data on socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"send"}},"children":[],"locations":[{"type":"absolute","value":268439809}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"sendto"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASend"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASendMsg"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASendTo"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"send"}},"children":[],"locations":[{"type":"absolute","value":268439809}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::Send"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendTo"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::SendToAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.UdpClient::Send"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439568}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"send file via HTTP"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"receive data":{"meta":{"name":"receive data","namespace":"communication","authors":["william.ballenthin@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Command and Control","C2 Communication","Receive Data"],"objective":"Command and Control","behavior":"C2 Communication","method":"Receive Data","id":"B0030.002"}],"references":[],"examples":["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60"],"description":"all known techniques for receiving data from a potential C2 server","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: receive data\r\n    namespace: communication\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n    description: all known techniques for receiving data from a potential C2 server\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Command and Control::C2 Communication::Receive Data [B0030.002]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\r\n  features:\r\n    - or:\r\n      - match: receive data on socket\r\n      - match: read data from Internet\r\n      - match: download URL\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"receive data on socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"recv"}},"children":[],"locations":[{"type":"absolute","value":268439858}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"recvfrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecv"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvDisconnect"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSARecvMsg"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"recv"}},"children":[],"locations":[{"type":"absolute","value":268439858}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::Receive"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveFromAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveMessageFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ReceiveMessageFromAsync"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::BeginReceive"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::BeginReceiveFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::BeginReceiveMessageFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::EndReceive"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::EndReceiveFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::EndReceiveMessageFrom"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"recvmsg"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439568}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"read data from Internet"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"download URL"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"connect TCP socket":{"meta":{"name":"connect TCP socket","namespace":"communication/socket/tcp","authors":["moritz.raabe@mandiant.com","joakim@intezer.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","Connect Socket"],"objective":"Communication","behavior":"Socket Communication","method":"Connect Socket","id":"C0001.004"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: connect TCP socket\r\n    namespace: communication/socket/tcp\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - joakim@intezer.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Communication::Socket Communication::Connect Socket [C0001.004]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - and:\r\n      - match: create TCP socket\r\n      - or:\r\n        - api: connect\r\n        - api: ws2_32.connect\r\n        - api: ws2_32.WSAConnect\r\n        - api: ConnectEx\r\n        - or:\r\n          - and:\r\n            # static\r\n            - basic block:\r\n              # candidate for GUID: WSAID_CONNECTEX/25a207b9-ddf3-4660-8ee9-76e58c74063e\r\n              - and:\r\n                - number: 0x25A207B9\r\n                - number: 0x4660DDF3\r\n                - number: 0xE576E98E\r\n                - number: 0x3E06748C\r\n            - basic block:\r\n              - and:\r\n                - api: WSAIoctl\r\n                - number: 0xC8000006 = SIO_GET_EXTENSION_FUNCTION_POINTER\r\n            - basic block:\r\n              - and:\r\n                - api: setsockopt\r\n                - number: 0xFFFF = SOL_SOCKET\r\n                - number: 0x7010 = SO_UPDATE_CONNECT_CONTEXT\r\n            # socket must be bound to ConnectEx\r\n            # https://gist.github.com/joeyadams/4158972\r\n            - api: bind\r\n          - and:\r\n            # dynamic\r\n            - call:\r\n              - and:\r\n                - api: WSAIoctl\r\n                - number: 0xC8000006 = SIO_GET_EXTENSION_FUNCTION_POINTER\r\n            - call:\r\n              - and:\r\n                - api: setsockopt\r\n                - number: 0xFFFF = SOL_SOCKET\r\n                - number: 0x7010 = SO_UPDATE_CONNECT_CONTEXT\r\n            # socket must be bound to ConnectEx\r\n            # https://gist.github.com/joeyadams/4158972\r\n            - api: bind\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"create TCP socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Net.Sockets.TcpClient::Client"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6,"description":"IPPROTO_TCP"}},"children":[],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":1,"description":"SOCK_STREAM"}},"children":[],"locations":[{"type":"absolute","value":268439694}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2,"description":"AF_INET"}},"children":[],"locations":[{"type":"absolute","value":268439696}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASocket"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"connect"}},"children":[],"locations":[{"type":"absolute","value":268439758}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"connect"}},"children":[],"locations":[{"type":"absolute","value":268439758}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSAConnect"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ConnectEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/0b7de8a6318443cc9720290a2b44f4d0"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/59eebe50ff3e416399c0eabfdf8502a7"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/9dfde07ac96a4a0383528e1ec48754a4"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"bind"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/b524bc633fc4426f868510c95b3dc96e"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/32abf8e3d08b418d85363ab7f567f6fe"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"bind"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"act as TCP client":{"meta":{"name":"act as TCP client","namespace":"communication/tcp/client","authors":["william.ballenthin@mandiant.com","michael.hunhoff@mandiant.com"],"scopes":{"static":"function","dynamic":"thread"},"attack":[],"mbc":[{"parts":["Communication","Socket Communication","TCP Client"],"objective":"Communication","behavior":"Socket Communication","method":"TCP Client","id":"C0001.008"}],"references":[],"examples":["Practical Malware Analysis Lab 01-01.dll_:0x10001010"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: act as TCP client\r\n    namespace: communication/tcp/client\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: thread\r\n    mbc:\r\n      - Communication::Socket Communication::TCP Client [C0001.008]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\r\n  features:\r\n    - or:\r\n      - match: connect TCP socket\r\n      - api: System.Net.Sockets.TcpClient::ctor\r\n","matches":[[{"type":"absolute","value":268439568},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"create TCP socket"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"property","access":"read","property":"System.Net.Sockets.TcpClient::Client"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":6,"description":"IPPROTO_TCP"}},"children":[],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":1,"description":"SOCK_STREAM"}},"children":[],"locations":[{"type":"absolute","value":268439694}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":2,"description":"AF_INET"}},"children":[],"locations":[{"type":"absolute","value":268439696}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSASocket"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"socket"}},"children":[],"locations":[{"type":"absolute","value":268439698}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.Socket::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439692}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"connect"}},"children":[],"locations":[{"type":"absolute","value":268439758}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"connect"}},"children":[],"locations":[{"type":"absolute","value":268439758}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WSAConnect"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ConnectEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/0b7de8a6318443cc9720290a2b44f4d0"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/59eebe50ff3e416399c0eabfdf8502a7"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/9dfde07ac96a4a0383528e1ec48754a4"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"bind"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/b524bc633fc4426f868510c95b3dc96e"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"connect TCP socket/32abf8e3d08b418d85363ab7f567f6fe"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"bind"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":268439568}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"System.Net.Sockets.TcpClient::ctor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]}}}
